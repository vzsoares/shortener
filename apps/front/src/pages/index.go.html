{{ template "base.go.html" . }} {{ define "title" }}Shortener{{ end }} {{ define
"page" }}
<div class="min-h-screen flex flex-col bg-neutral-500">
    <!-- navbar -->
    <div class="max-w-screen-lg mx-auto w-full">
        <div class="p-2">
            <h1 class="text-primary font-bold text-4xl">S</h1>
        </div>
    </div>
    <!-- body -->
    <div class="max-w-screen-lg mx-auto w-full flex-1 mt-[20%] flex flex-col">
        <form class="flex px-2" onsubmit="return shortenUrl(event)">
            <input class="h-10 w-full p-2" type="text" name="url" value="" />
            <button
                type="submit"
                class="bg-primary p-2 text-neutral-500 hover:scale-110 active:opacity-80"
            >
                Shorten
            </button>
        </form>
        <div
            class="mx-6 opacity-0 transition-all duration-300 ease"
            id="result-box"
        >
            <div class="border border-light mt-8 w-full flex">
                <p class="w-full p-2" id="result"></p>
                <button
                    type="submit"
                    onclick="copyResultToClibBoard()"
                    class="border border-light p-2 text-primary hover:scale-90 active:opacity-80"
                >
                    Copy
                </button>
            </div>
        </div>
        <script>
            const baseUrl =
                "https://api-dev.zenhalab.com/shortener/v1/public-api";

            function shortenUrl(e) {
                e.preventDefault();
                const formData = new FormData(e.target);
                const formProps = Object.fromEntries(formData);
                const url = formProps["url"];
                if (!isUrl(url)) {
                    window.alert("Invalid Url ):");
                    return;
                }
                // fetch url
                createEntry(url).then((v) => {
                    // display url
                    const resultE = document.getElementById("result");
                    const resultBoxE = document.getElementById("result-box");
                    resultBoxE.classList.remove("opacity-0");

                    resultE.innerHTML = v;
                });
            }

            async function createEntry(url) {
                return "https://test.com";
                const res = fetch(`${baseUrl}/url`, {
                    method: "POST",
                    body: JSON.stringify({ destination: url }),
                    headers: {
                        "Content-Type": "application/json",
                        Accept: "*/*",
                    },
                })
                    .then((r) => r.JSON())
                    .then((r) => r.data.url)
                    .catch(() => null);
                return res;
            }

            function copyResultToClibBoard() {
                const resultE = document.getElementById("result");
                // TODO display alert
                // disaply for when fetch fails too
                navigator.clipboard.writeText(resultE.innerHTML).then(
                    () =>
                        console.log(
                            "Async: Copying to clipboard was successful!",
                        ),
                    (err) => console.error("Async: Could not copy text: ", err),
                );
            }

            function isUrl(url) {
                try {
                    const u = new URL(url);
                    return u.protocol === "https:";
                } catch {
                    return false;
                }
            }
        </script>
    </div>
    <!-- footer -->
    <div class="max-w-screen-lg mx-auto w-full">
        <div class="flex p-2 flex-col">
            <div class="ml-auto flex gap-6">
                <a
                    href="https://www.linkedin.com/in/vinicius-zenha/"
                    target="_blank"
                >
                    <p>linkedin</p>
                </a>
                <a href="https://github.com/vzsoares" target="_blank">
                    <p>github</p>
                </a>
            </div>
        </div>
    </div>
</div>
{{ end }}
